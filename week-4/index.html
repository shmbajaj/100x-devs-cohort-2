<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>React DOM Practice Assignment</title>
    <style>
      .none {
        display: none;
      }
    </style>
    <!-- <script>
      let globalId = 1;
      let todoState = [];
      let oldTodoState = [];

      function addTodoToDom() {}

      function removeTodoFromDom(todo) {}

      function updateTodoInDom(oldTodo, newTodo) {}

      function updateState(newTodos) {
        // calculate the diff b/w newTodos and oldTodos.
        // More specifically, find out what todos are -
        // 1. added
        // 2. deleted
        // 3. updated
        const added = [];
        const deleted = [];
        const updated = [];
        const newTodosIds = newTodos.map((t) => t.id);
        const oldTodosIds = oldTodoState.map((t) => t.id);
        // calculate these 3 arrays
        // call addTodo, removeTodo, updateTodo functions on each of the
        // elements
        oldTodoState = newTodos;
      }

      function addTodo() {
        const title = document.getElementById('title').value;
        const description = document.getElementById('description').value;
        todoState.push({
          title: title,
          description: description,
          id: globalId++,
        });
        updateState(todoState);
      }
    </script> -->
  </head>

  <body>
    <form id="add-todo">
      <input type="text" name="title" placeholder="Todo title" required />
      <input
        type="text"
        name="description"
        placeholder="Todo description"
        required
      />
      <button type="submit">Add todo</button>
    </form>

    <div id="todos"></div>
    <script>
      let globalId = 1;
      let todoState = [];
      let oldTodoState = [];

      const todos = document.getElementById('todos');

      function deleteHandler(e) {
        const parent = e.target.parentElement;
        const id = parent.getAttribute('data-todoid');
        const index = todoState.findIndex((t) => t.id === id);
        todoState.splice(index, 1);
        updateState(todoState);
      }

      function removeTodoFromDom(todo) {
        document.querySelector(`[data-todoid="${todo.id}"]`).remove();
      }

      function addTodoToDom(todo) {
        const todoContainer = document.createElement('article');
        const todoTitle = document.createElement('div');
        const todoDescription = document.createElement('p');
        const todoId = document.createElement('span');
        const deleteTodo = document.createElement('button');

        todoId.classList.add('none');
        todoId.textContent = todo.id;
        todoDescription.textContent = todo.description;
        todoTitle.textContent = todo.title;

        deleteTodo.textContent = 'Delete';
        deleteTodo.addEventListener('click', deleteHandler);

        todoContainer.appendChild(todoId);
        todoContainer.appendChild(todoTitle);
        todoContainer.appendChild(todoDescription);
        todoContainer.appendChild(deleteTodo);

        todoContainer.setAttribute('data-todoid', todo.id);

        todos.prepend(todoContainer);
      }

      function updateState(newTodos) {
        // calculate the diff b/w newTodos and oldTodos.
        // More specifically, find out what todos are -
        // 1. added
        // 2. deleted
        // 3. updated
        const newTodosIds = newTodos.map((t) => t.id);
        const oldTodosIds = oldTodoState.map((t) => t.id);
        const added = newTodos.filter((e) => !oldTodosIds.includes(e.id));
        const deleted = oldTodoState.filter((e) => !newTodosIds.includes(e.id));
        const updated = [];

        // calculate these 3 arrays
        // call addTodo, removeTodo, updateTodo functions on each of the
        // elements
        added.forEach((t) => addTodoToDom(t));
        deleted.forEach((t) => removeTodoFromDom(t));
        oldTodoState = newTodos.slice();
      }

      function addTodo({ title, description }) {
        todoState.push({
          title: title,
          description: description,
          id: globalId++,
        });
        updateState(todoState);
      }
    </script>
    <script>
      const form = document.getElementById('add-todo');
      const getData = () => {
        const formData = new FormData(form);
        const title = formData.get('title');
        const description = formData.get('description');
        form.reset();
        addTodo({ title, description });
      };
      const onSubmit = (e) => {
        e.preventDefault();
        getData();
      };
      form.addEventListener('submit', onSubmit);
    </script>
  </body>
</html>
